var ERE_Property_Map_Search=ERE_Property_Map_Search||{};!function($){"use strict";var ajax_url=ere_search_vars.ajax_url,price_is_slider=ere_search_vars.price_is_slider,css_class_wrap=".ere-search-properties";ERE_Property_Map_Search={init:function(){this.full_screen(),this.get_states_by_country(),$(".ere-property-country-ajax",css_class_wrap).on("change",function(){ERE_Property_Map_Search.get_states_by_country()}),this.get_cities_by_state(),$(".ere-property-state-ajax",css_class_wrap).on("change",function(){ERE_Property_Map_Search.get_cities_by_state()}),this.get_neighborhoods_by_city(),$(".ere-property-city-ajax",css_class_wrap).on("change",function(){ERE_Property_Map_Search.get_neighborhoods_by_city()}),$(".btn-status-filter",css_class_wrap).on("click",function(e){e.preventDefault();var a=$(this).data("value");$(this).parent().find("input").val(a),$(this).parent().find("button").removeClass("active"),$(this).addClass("active"),ERE_Property_Map_Search.change_price_on_status_change(a)}),$('select[name="status"]',css_class_wrap).on("change",function(e){e.preventDefault();var a=$(this).val();ERE_Property_Map_Search.change_price_on_status_change(a)}),this.execute_url_search(),$(".ere-sliderbar-filter.ere-sliderbar-price",css_class_wrap).on("register.again",function(){$(".ere-sliderbar-filter.ere-sliderbar-price",css_class_wrap).each(function(){var e=$(this);ERE_Property_Map_Search.set_slider_filter(e)})}),this.register_slider_filter(),this.set_slider_value(),$(".other-features-wrap .btn-other-features",css_class_wrap).on("click",function(e){e.preventDefault();var a=$(this).parents("div.ere-search-properties").find(".ere-map-result").attr("id"),r="#"+a;if($(".other-features-list",css_class_wrap).slideToggle(),$(this).toggleClass("show"),1==$(this).hasClass("show")?($('input[name="features-search"]',css_class_wrap).attr("value","1"),$(this).find("i").removeClass("fa-chevron-down"),$(this).find("i").addClass("fa-chevron-up")):($('input[name="features-search"]',css_class_wrap).attr("value","0"),$(this).find("i").removeClass("fa-chevron-up"),$(this).find("i").addClass("fa-chevron-down")),$(r).length>0){var t=$(this).parents(".search-properties-form");ERE_Property_Map_Search.search_on_change(t,a)}}),$(".ere-sliderbar-filter.ere-sliderbar-price",css_class_wrap).on("register.again",function(){$(".ere-sliderbar-filter.ere-sliderbar-price",css_class_wrap).each(function(){var e=$(this);ERE_Property_Map_Search.set_slider_filter(e)})}),$(".ere-search-properties").each(function(){var e=$(this),a=$(this).find(".ere-map-result").attr("id"),r="#"+a;$(".ere-search-status-tab .btn-status-filter",e).on("click",function(){$(this).parent().find("input").val($(this).data("value")),$(this).parent().find("button").removeClass("active"),$(this).addClass("active")}),$(r).length>0&&($('select[name="type"],select[name="status"],input[name="status"], select[name="bedrooms"],select[name="bathrooms"] , select[name="garage"], select[name="label"],input[name="address"],input[name="title"],input[name="property_identity"], select[name="min-price"], select[name="max-price"],select[name="min-area"], select[name="max-area"],select[name="min-land-area"], select[name="min-land-area"], select[name="city"], select[name="country"], select[name="state"], select[name="neighborhood"]',e).on("change",function(){var r=e.find(".search-properties-form");ERE_Property_Map_Search.search_on_change(r,a)}),$(".ere-search-status-tab .btn-status-filter",e).on("click",function(){var r=e.find(".search-properties-form");ERE_Property_Map_Search.search_on_change(r,a)}),$('input[name="other_features"]',e).on("change",function(){var r=e.find(".search-properties-form");ERE_Property_Map_Search.search_on_change(r,a)}),ERE_Property_Map_Search.search_properties("","","","","","","","","","","","","","","","","","","","",a,"map_only"))})},get_states_by_country:function(){if($(".ere-property-country-ajax",css_class_wrap).length){var e=$(".ere-property-country-ajax").val();""!=e&&$.ajax({type:"POST",url:ajax_url,data:{action:"ere_get_states_by_country_ajax",country:e,type:1},success:function(e){$(".ere-property-state-ajax",css_class_wrap).html(e);var a=$(".ere-property-state-ajax",css_class_wrap).attr("data-selected");"undefined"!=a&&$(".ere-property-state-ajax",css_class_wrap).val(a)}})}},get_cities_by_state:function(){if($(".ere-property-state-ajax",css_class_wrap).length){var e=$(".ere-property-state-ajax",css_class_wrap).val();""!=e&&$.ajax({type:"POST",url:ajax_url,data:{action:"ere_get_cities_by_state_ajax",state:e,type:1},success:function(e){$(".ere-property-city-ajax",css_class_wrap).html(e);var a=$(".ere-property-city-ajax",css_class_wrap).attr("data-selected");"undefined"!=a&&$(".ere-property-city-ajax",css_class_wrap).val(a)}})}},get_neighborhoods_by_city:function(){if($(".ere-property-city-ajax",css_class_wrap).length){var e=$(".ere-property-city-ajax").val();""!=e&&$.ajax({type:"POST",url:ajax_url,data:{action:"ere_get_neighborhoods_by_city_ajax",city:e,type:1},success:function(e){$(".ere-property-neighborhood-ajax",css_class_wrap).html(e);var a=$(".ere-property-neighborhood-ajax",css_class_wrap).attr("data-selected");"undefined"!=a&&$(".ere-property-neighborhood-ajax",css_class_wrap).val(a)}})}},execute_url_search:function(){$(".ere-advanced-search-btn",css_class_wrap).on("click",function(e){e.preventDefault();var a=$(this).closest(".search-properties-form"),r=a.data("href"),t=[],s="?";if(-1!==r.indexOf("?")&&(s="&"),$(".search-field",a).each(function(){var e=$(this),a=e.attr("name"),r=e.val(),s=e.data("default-value");r!=s&&(t[a]=r)}),$(".ere-sliderbar-filter",a).each(function(){var e=$(this),a=e.find(".min-input-request").attr("name"),r=e.find(".max-input-request").attr("name"),s=e.find(".min-input-request").val(),i=e.find(".max-input-request").val(),n=e.data("min-default"),o=e.data("max-default");(s!=n||i!=o)&&(t[a]=s,t[r]=i)}),"undefined"!=typeof t["features-search"]){var i="";$('[name="other_features"]',a).each(function(){var e=$(this),a=e.attr("value");e.is(":checked")&&(i+=a+";")}),""!==i&&(i=i.substring("0",i.length-1),t.other_features=i)}if(t!==[])for(var n in t)t.hasOwnProperty(n)&&(s+=n+"="+t[n]+"&");s=s.substring("0",s.length-1),window.location.href=r+s})},set_slider_filter:function(e){var a,r,t=e,s=parseInt(t.attr("data-min-default")),i=parseInt(t.attr("data-max-default")),n=t.attr("data-min"),o=t.attr("data-max"),l=t.find(".sidebar-filter");l.slider({min:s,max:i,range:!0,values:[n,o],slide:function(e,s){a=s.values[0],r=s.values[1],t.attr("data-min",a),t.attr("data-max",r),t.find("input.min-input-request").attr("value",a),t.find("input.max-input-request").attr("value",r),t.find("span").hasClass("not-format")?(t.find("span.min-value").html(a),t.find("span.max-value").html(r)):(t.find("span.min-value:not(.not-format)").html(ERE.number_format(a)),t.find("span.max-value:not(.not-format)").html(ERE.number_format(r)))},stop:function(e,a){var r=$(e.target),t=r.parents("div.ere-search-properties").find(".ere-map-result").attr("id"),s="#"+t;if($(s).length>0){var i=$(this).parents(".search-properties-form");ERE_Property_Map_Search.search_on_change(i,t)}}})},register_slider_filter:function(){$(".ere-sliderbar-filter",css_class_wrap).each(function(){var e=$(this);ERE_Property_Map_Search.set_slider_filter(e)})},set_slider_value:function(){$(".ere-sliderbar-filter",css_class_wrap).each(function(){var e=$(this),a=e.attr("data-min-default"),r=e.attr("data-max-default"),t=e.attr("data-min"),s=e.attr("data-max"),i=(t-a)/(r-a)*100+"%",n=(s-t)/(r-a)*100+"%",o=(s-a)/(r-a)*100+"%";e.find(".ui-slider-range.ui-corner-all.ui-widget-header").css({left:i,width:n}),e.find(".ui-slider-handle.ui-corner-all.ui-state-default").css("left",i),e.find(".ui-slider-handle.ui-corner-all.ui-state-default:last-child").css("left",o)})},change_price_on_status_change:function(status){$.ajax({type:"POST",url:ajax_url,dataType:"json",data:{action:"ere_ajax_change_price_on_status_change",status:status,price_is_slider:price_is_slider},success:function(e){e.slide_html?($(".ere-sliderbar-price-wrap",css_class_wrap).html(e.slide_html),ERE_Property_Map_Search.register_slider_filter(),ERE_Property_Map_Search.set_slider_value()):(e.min_price_html&&$('select[name="min-price"]',css_class_wrap).html(e.min_price_html),e.max_price_html&&$('select[name="max-price"]',css_class_wrap).html(e.max_price_html))},error:function(xhr){var err=eval("("+xhr.responseText+")");console.log(err.Message)}})},full_screen:function(){if($(".ere-search-properties.style-vertical").length>0){var e=$(window).outerHeight(),a=$("#wpadminbar").outerHeight();null==a&&(a=0);var r=$("header").outerHeight(),t=$("footer").outerHeight(),s=$(".wpadminbar").outerHeight(),i=e-a-r-t-s;$(".ere-search-properties.style-vertical .ere-map-search").css("height",i),$(".ere-search-properties.style-vertical .ere-map-search .ere-map-result").css("height",i),$(".col-scroll-vertical").css({height:i,"overflow-y":"scroll","overflow-x":"hidden"});var n=$(".owl-carousel",".list-property-result-ajax"),o=$(".property-item",n);n.trigger("destroy.owl.carousel"),n.css("opacity",1),n.imagesLoaded(function(){ERE.set_item_effect(o,"hide"),ERE_Carousel.owlCarousel(),o=$(".property-item",n),ERE.set_item_effect(o,"show")})}},search_on_change:function(e,a){var r,t,s,i,n,o,l,c,_,p,d,u,m,h,f,g,v,y,x,b,w,E;n=e.find('input[name="title"]').val(),h=e.find('input[name="address"]').val(),t=e.find('select[name="city"]').val(),l=e.find('select[name="type"]').val(),o=e.find('select[name="status"]').val(),void 0==o&&(o=e.find('input[name="status"]').val()),c=e.find('select[name="bedrooms"]').val(),_=e.find('select[name="bathrooms"]').val(),$(".ere-sliderbar-price",e).length?(p=e.find(".ere-sliderbar-filter.ere-sliderbar-price").attr("data-min"),d=e.find(".ere-sliderbar-filter.ere-sliderbar-price").attr("data-max")):(p=e.find('select[name="min-price"]').val(),d=e.find('select[name="max-price"]').val()),$(".ere-sliderbar-area",e).length?(u=e.find(".ere-sliderbar-filter.ere-sliderbar-area").attr("data-min"),m=e.find(".ere-sliderbar-filter.ere-sliderbar-area").attr("data-max")):(u=e.find('select[name="min-area"]').val(),m=e.find('select[name="max-area"]').val()),$(".ere-sliderbar-land-area",e).length?(y=e.find(".ere-sliderbar-filter.ere-sliderbar-land-area").attr("data-min"),x=e.find(".ere-sliderbar-filter.ere-sliderbar-land-area").attr("data-max")):(y=e.find('select[name="min-land-area"]').val(),x=e.find('select[name="max-land-area"]').val()),s=e.find('select[name="state"]').val(),r=e.find('select[name="country"]').val(),i=e.find('select[name="neighborhood"]').val(),v=e.find('select[name="label"]').val(),f=e.find('select[name="garage"]').val(),b=e.find('input[name="property_identity"]').val(),w=e.find('input[name="features-search"]').val(),"1"==w&&(g="",e.find(".other-features-list input[type=checkbox]:checked").each(function(){g+=$(this).val()+";"}),""!=g&&(g=g.substring(0,g.length-1))),E=a;var P="map_only";$(".list-property-result-ajax",css_class_wrap).length>0&&(P="map_and_content"),ERE_Property_Map_Search.search_properties(n,h,r,s,t,i,l,o,c,_,p,d,u,m,v,f,y,x,b,g,E,P)},search_properties:function(title,address,country,state,city,neighborhood,type,status,bedrooms,bathrooms,min_price,max_price,min_area,max_area,label,garage,min_land_area,max_land_area,property_identity,features,map_result,search_type){var ere_security_search_map=$("#ere_security_search_map").val(),map_result_content=$("#"+map_result),ere_map,markers=[],marker_cluster=null,googlemap_default_zoom=ere_search_vars.googlemap_default_zoom,not_found=ere_search_vars.not_found,clusterIcon=ere_search_vars.clusterIcon,google_map_style=ere_search_vars.google_map_style,pin_cluster_enable=ere_search_vars.pin_cluster_enable,drgflag=!0;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(drgflag=!1);var ere_search_map_option={zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},scrollwheel:!1,scroll:{x:$(window).scrollLeft(),y:$(window).scrollTop()},zoom:parseInt(googlemap_default_zoom),mapTypeId:google.maps.MapTypeId.ROADMAP,draggable:drgflag,fullscreenControl:!0,fullscreenControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER}},infobox=new InfoBox({disableAutoPan:!0,maxWidth:310,alignBottom:!0,pixelOffset:new google.maps.Size(-140,-55),zIndex:null,closeBoxMargin:"0 0 -16px -16px",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1}),ere_add_markers=function(e,a){$.each(e,function(e,r){var t=new google.maps.LatLng(r.lat,r.lng),s=r.marker_icon,i=new google.maps.Size(44,60),n={url:s,size:i,scaledSize:new google.maps.Size(44,60),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(7,27)},o=new google.maps.Marker({position:t,map:a,icon:n,draggable:!1,animation:google.maps.Animation.DROP}),l=r.data?r.data.post_title:r.title,c="";(""==r.image_url||"undefined"==typeof r.image_url)&&(c='style="display: none;"');var _=document.createElement("div");_.className="marker-content clearfix",_.innerHTML='<div class="marker-content-inner clearfix"><div class = "item-thumb" '+c+'><a href="'+r.url+'"><img src="'+r.image_url+'" alt="'+l+'" style="width: 100px;"></a></div><div class="item-body"><a href="'+r.url+'" class="title-marker">'+l+'</a><div class="price-marker">'+r.price+'</div><div class="address-marker"><i class="fa fa-map-marker"></i>'+r.address+"</div></div></div>",google.maps.event.addListener(o,"click",function(e,r){return function(){var r=Math.pow(2,a.getZoom()),t=100/r||0,s=a.getProjection(),i=e.getPosition(),n=s.fromLatLngToPoint(i),o=new google.maps.Point(n.x,n.y-t),l=s.fromPointToLatLng(o);a.setCenter(l),setTimeout(function(){infobox.setContent(_),infobox.open(a,e)},300)}}(o,e)),markers.push(o)})};$.ajax({dataType:"json",url:ajax_url,data:{action:"ere_property_search_ajax",title:title,address:address,country:country,state:state,city:city,neighborhood:neighborhood,type:type,status:status,bedrooms:bedrooms,bathrooms:bathrooms,min_price:min_price,max_price:max_price,min_area:min_area,max_area:max_area,label:label,garage:garage,min_land_area:min_land_area,max_land_area:max_land_area,property_identity:property_identity,features:features,search_type:search_type,ere_security_search_map:ere_security_search_map},beforeSend:function(){map_result_content.parents("div.ere-search-properties").find("#ere-map-loading").fadeIn()},success:function(e){if("map_and_content"==search_type){var a=$(".owl-carousel",".list-property-result-ajax"),r=$(".list-property-result-ajax");if(a.empty(),e.success===!1)r.find(".title-result h2 .number-result").hide(),r.find(".title-result h2 .text-no-result").show(),r.find(".title-result h2 .text-result").hide();else{var t=$(".property-item",e.property_html);a.css("opacity",0),a.trigger("destroy.owl.carousel"),a.html(t),a.css("opacity",1),a.imagesLoaded(function(){ERE.set_item_effect(t,"hide"),ERE_Carousel.owlCarousel(),t=$(".property-item",a),ERE.set_item_effect(t,"show")}),"0"!=t.length&&(r.find(".title-result h2 .number-result").html(t.length),r.find(".title-result h2 .number-result").show(),r.find(".title-result h2 .text-no-result").hide(),r.find(".title-result h2 .text-result").show())}ERE.favorite(),ERE.tooltip(),ERE_Compare.register_event_compare()}if(ere_map=new google.maps.Map(document.getElementById(map_result),ere_search_map_option),ere_map.set("scrollwheel",!1),google.maps.event.trigger(ere_map,"resize"),e.success===!0&&e.properties)var s=e.properties.length;if(1==s)var i=google.maps.event.addListener(ere_map,"bounds_changed",function(e){this.setZoom(parseInt(googlemap_default_zoom)),google.maps.event.removeListener(i)});if(""!==google_map_style){var n=JSON.parse(google_map_style);ere_map.setOptions({styles:n})}var o=new google.maps.LatLng("","");if(ere_map.setCenter(o),ere_map.setZoom(parseInt(googlemap_default_zoom)),google.maps.event.addListener(ere_map,"tilesloaded",function(){$("#ere-map-loading").fadeOut()}),e.success===!0){for(var l=0;l<markers.length;l++)markers[l].setMap(null);markers=[],ere_add_markers(e.properties,ere_map),ere_map.fitBounds(markers.reduce(function(e,a){return e.extend(a.getPosition())},new google.maps.LatLngBounds)),google.maps.event.trigger(ere_map,"resize"),"1"==pin_cluster_enable&&(marker_cluster=new MarkerClusterer(ere_map,markers,{gridSize:60,styles:[{url:clusterIcon,width:48,height:48,textColor:"#fff"}]}))}else map_result_content.empty().html('<div class="map-notfound">'+not_found+"</div>");map_result_content.closest("div.ere-search-properties").find("#ere-map-loading").fadeOut("slow")},error:function(xhr){var err=eval("("+xhr.responseText+")");console.log(err.Message),map_result_content.closest("div.ere-search-properties").find("#ere-map-loading").fadeOut("slow")}})}},$(document).ready(function(){ERE_Property_Map_Search.init()}),$(window).resize(function(){ERE_Property_Map_Search.full_screen()}),$(window).on("orientationchange",function(){ERE_Property_Map_Search.full_screen()})}(jQuery);
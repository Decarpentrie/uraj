var ERE_Property_Advanced_Search=ERE_Property_Advanced_Search||{};!function($){"use strict";var ajax_url=ere_property_advanced_search_vars.ajax_url,price_is_slider=ere_property_advanced_search_vars.price_is_slider,css_class_wrap=".ere-property-advanced-search";ERE_Property_Advanced_Search={init:function(){this.get_states_by_country(),$(".ere-property-country-ajax",css_class_wrap).on("change",function(){ERE_Property_Advanced_Search.get_states_by_country()}),this.get_cities_by_state(),$(".ere-property-state-ajax",css_class_wrap).on("change",function(){ERE_Property_Advanced_Search.get_cities_by_state()}),this.get_neighborhoods_by_city(),$(".ere-property-city-ajax",css_class_wrap).on("change",function(){ERE_Property_Advanced_Search.get_neighborhoods_by_city()}),$(".btn-status-filter",css_class_wrap).on("click",function(e){e.preventDefault();var a=$(this).data("value");$(this).parent().find("input").val(a),$(this).parent().find("button").removeClass("active"),$(this).addClass("active"),ERE_Property_Advanced_Search.change_price_on_status_change(a)}),$('select[name="status"]',css_class_wrap).on("change",function(e){e.preventDefault();var a=$(this).val();ERE_Property_Advanced_Search.change_price_on_status_change(a)}),this.execute_url_search(),$(".ere-sliderbar-filter.ere-sliderbar-price",css_class_wrap).on("register.again",function(){$(".ere-sliderbar-filter.ere-sliderbar-price",css_class_wrap).each(function(){var e=$(this);ERE_Property_Advanced_Search.set_slider_filter(e)})}),this.register_slider_filter(),this.set_slider_value(),$(".other-features-wrap .btn-other-features",css_class_wrap).on("click",function(e){e.preventDefault(),$(".other-features-list",css_class_wrap).slideToggle(),$(this).toggleClass("show"),1==$(this).hasClass("show")?($('input[name="features-search"]',css_class_wrap).attr("value","1"),$(this).find("i").removeClass("fa-chevron-down"),$(this).find("i").addClass("fa-chevron-up")):($('input[name="features-search"]',css_class_wrap).attr("value","0"),$(this).find("i").removeClass("fa-chevron-up"),$(this).find("i").addClass("fa-chevron-down"))})},get_states_by_country:function(){if($(".ere-property-country-ajax",css_class_wrap).length){var e=$(".ere-property-country-ajax").val();""!=e&&$.ajax({type:"POST",url:ajax_url,data:{action:"ere_get_states_by_country_ajax",country:e,type:1},success:function(e){$(".ere-property-state-ajax",css_class_wrap).html(e);var a=$(".ere-property-state-ajax",css_class_wrap).attr("data-selected");"undefined"!=a&&$(".ere-property-state-ajax",css_class_wrap).val(a)}})}},get_cities_by_state:function(){if($(".ere-property-state-ajax",css_class_wrap).length){var e=$(".ere-property-state-ajax",css_class_wrap).val();""!=e&&$.ajax({type:"POST",url:ajax_url,data:{action:"ere_get_cities_by_state_ajax",state:e,type:1},success:function(e){$(".ere-property-city-ajax",css_class_wrap).html(e);var a=$(".ere-property-city-ajax",css_class_wrap).attr("data-selected");"undefined"!=a&&$(".ere-property-city-ajax",css_class_wrap).val(a)}})}},get_neighborhoods_by_city:function(){if($(".ere-property-city-ajax",css_class_wrap).length){var e=$(".ere-property-city-ajax").val();""!=e&&$.ajax({type:"POST",url:ajax_url,data:{action:"ere_get_neighborhoods_by_city_ajax",city:e,type:1},success:function(e){$(".ere-property-neighborhood-ajax",css_class_wrap).html(e);var a=$(".ere-property-neighborhood-ajax",css_class_wrap).attr("data-selected");"undefined"!=a&&$(".ere-property-neighborhood-ajax",css_class_wrap).val(a)}})}},execute_url_search:function(){$(".ere-advanced-search-btn",css_class_wrap).on("click",function(e){e.preventDefault();var a=$(this).closest(".search-properties-form"),t=a.data("href"),r=[],s="?";if(-1!==t.indexOf("?")&&(s="&"),$(".search-field",a).each(function(){var e=$(this),a=e.attr("name"),t=e.val(),s=e.data("default-value");t!=s&&(r[a]=t)}),$(".ere-sliderbar-filter",a).each(function(){var e=$(this),a=e.find(".min-input-request").attr("name"),t=e.find(".max-input-request").attr("name"),s=e.find(".min-input-request").val(),i=e.find(".max-input-request").val(),n=e.data("min-default"),c=e.data("max-default");(s!=n||i!=c)&&(r[a]=s,r[t]=i)}),"undefined"!=typeof r["features-search"]){var i="";$('[name="other_features"]',a).each(function(){var e=$(this),a=e.attr("value");e.is(":checked")&&(i+=a+";")}),""!==i&&(i=i.substring("0",i.length-1),r.other_features=i)}if(r!==[])for(var n in r)r.hasOwnProperty(n)&&(s+=n+"="+r[n]+"&");s=s.substring("0",s.length-1),window.location.href=t+s})},set_slider_filter:function(e){var a,t,r=e,s=parseInt(r.attr("data-min-default")),i=parseInt(r.attr("data-max-default")),n=r.attr("data-min"),c=r.attr("data-max"),_=r.find(".sidebar-filter");_.slider({min:s,max:i,range:!0,values:[n,c],slide:function(e,s){a=s.values[0],t=s.values[1],r.attr("data-min",a),r.attr("data-max",t),r.find("input.min-input-request").attr("value",a),r.find("input.max-input-request").attr("value",t),r.find("span").hasClass("not-format")?(r.find("span.min-value").html(a),r.find("span.max-value").html(t)):(r.find("span.min-value:not(.not-format)").html(ERE.number_format(a)),r.find("span.max-value:not(.not-format)").html(ERE.number_format(t)))},stop:function(e,a){}})},register_slider_filter:function(){$(".ere-sliderbar-filter",css_class_wrap).each(function(){var e=$(this);ERE_Property_Advanced_Search.set_slider_filter(e)})},set_slider_value:function(){$(".ere-sliderbar-filter",css_class_wrap).each(function(){var e=$(this),a=e.attr("data-min-default"),t=e.attr("data-max-default"),r=e.attr("data-min"),s=e.attr("data-max"),i=(r-a)/(t-a)*100+"%",n=(s-r)/(t-a)*100+"%",c=(s-a)/(t-a)*100+"%";e.find(".ui-slider-range.ui-corner-all.ui-widget-header").css({left:i,width:n}),e.find(".ui-slider-handle.ui-corner-all.ui-state-default").css("left",i),e.find(".ui-slider-handle.ui-corner-all.ui-state-default:last-child").css("left",c)})},change_price_on_status_change:function(status){$.ajax({type:"POST",url:ajax_url,dataType:"json",data:{action:"ere_ajax_change_price_on_status_change",status:status,price_is_slider:price_is_slider},success:function(e){e.slide_html?($(".ere-sliderbar-price-wrap",css_class_wrap).html(e.slide_html),ERE_Property_Advanced_Search.register_slider_filter(),ERE_Property_Advanced_Search.set_slider_value()):(e.min_price_html&&$('select[name="min-price"]',css_class_wrap).html(e.min_price_html),e.max_price_html&&$('select[name="max-price"]',css_class_wrap).html(e.max_price_html))},error:function(xhr){var err=eval("("+xhr.responseText+")");console.log(err.Message)}})}},$(document).ready(function(){ERE_Property_Advanced_Search.init()})}(jQuery);
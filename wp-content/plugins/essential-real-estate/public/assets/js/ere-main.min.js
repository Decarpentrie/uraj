var ERE=ERE||{};!function($){"use strict";var ajax_url=ere_main_vars.ajax_url,confirm_yes_text=ere_main_vars.confirm_yes_text,confirm_no_text=ere_main_vars.confirm_no_text,loading_text=ere_main_vars.loading_text,decimals=ere_main_vars.decimals,dec_point=ere_main_vars.dec_point,thousands_sep=ere_main_vars.thousands_sep;ERE={init:function(){this.favorite(),this.tooltip(),this.property_paging(),this.move_link_to_carousel(),this.execute_nav(),this.execute_slider_nav();var e=$(".pagination-image.ere-property-slider");this.sync_property_carousel(e),this.light_gallery()},number_format:function(e,t){t=void 0!==t?t:decimals,e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var a=isFinite(+e)?+e:0,n=isFinite(+t)?Math.abs(t):0,r=void 0===thousands_sep?",":thousands_sep,i=void 0===dec_point?".":dec_point,o="";return(o=(n?function(e,t){var a=Math.pow(10,t);return""+Math.round(e*a)/a}(a,n):""+Math.round(a)).split("."))[0].length>3&&(o[0]=o[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,r)),(o[1]||"").length<n&&(o[1]=o[1]||"",o[1]+=new Array(n-o[1].length+1).join("0")),o.join(i)},tooltip:function(){$('[data-toggle="tooltip"]').tooltip()},login_modal:function(){$("#ere_signin_modal").modal("show")},get_page_number_from_href:function(e){var t="",a=/paged=\d+/gi;return new RegExp(a).test(e)?t=new RegExp(a).exec(e):(a=/page\/\d+/gi,t=new RegExp(a).test(e)?new RegExp(a).exec(e):t),a=/\d+/g,new RegExp(a).test(t)?new RegExp(a).exec(t)[0]:1},favorite:function(){$(".property-favorite").on("click",function(e){if(e.preventDefault(),!$(this).hasClass("on-handle")){var $this=$(this).addClass("on-handle"),property_inner=$this.closest(".property-inner").addClass("property-active-hover"),property_id=$this.attr("data-property-id"),title_not_favorite=$this.attr("data-title-not-favorite"),title_favorited=$this.attr("data-title-favorited");$.ajax({type:"post",url:ajax_url,dataType:"json",data:{action:"ere_favorite_ajax",property_id:property_id},beforeSend:function(){$this.children("i").addClass("fa-spinner fa-spin")},success:function(e){e.added?($this.children("i").removeClass("fa-star-o").addClass("fa-star"),$this.attr("data-original-title",title_favorited)):($this.children("i").removeClass("fa-star").addClass("fa-star-o"),$this.attr("data-original-title",title_not_favorite)),$this.children("i").removeClass("fa-spinner fa-spin"),void 0===e.added&&ERE.login_modal(),$this.removeClass("on-handle"),property_inner.removeClass("property-active-hover")},error:function(xhr){var err=eval("("+xhr.responseText+")");console.log(err.Message),$this.children("i").removeClass("fa-spinner fa-spin"),$this.removeClass("on-handle"),property_inner.removeClass("property-active-hover")}})}})},light_gallery:function(){$("[data-rel='ere_light_gallery']").each(function(){var e=$(this),t=e.data("gallery-id");e.on("click",function(a){a.preventDefault();var n=[],r=0,i=$(this).attr("href"),o=$(this).data("thumb-src");void 0!==t&&($('[data-gallery-id="'+t+'"]').each(function(e){var t=$(this).attr("href"),a=$(this).data("thumb-src"),s=$(this).attr("title");t==i&&a==o&&(r=e),void 0===s&&(s=""),n.push({src:t,downloadUrl:t,thumb:a,subHtml:s})}),e.lightGallery({hash:!1,galleryId:t,dynamic:!0,dynamicEl:n,thumbWidth:80,index:r}))})}),$("a.ere-view-video").on("click",function(e){e.preventDefault();var t=$(this).attr("data-src");$(this).lightGallery({dynamic:!0,dynamicEl:[{src:t,thumb:"",subHtml:""}]})})},show_loading:function(e){"undefined"!=e&&""!=e&&null!=e||(e=loading_text);var t=wp.template("ere-processing-template");$("body").append(t({ico:"fa fa-spinner fa-spin",text:e}))},change_loading_status:function(e,t){$("i",".ere-processing").removeClass("fa-spinner fa-spin").addClass(e),$("span",".ere-processing").text(t)},close_loading:function(e){void 0!==e&&null!=e||(e=500),0==e?$(".ere-processing").remove():setTimeout(function(){$(".ere-processing").fadeOut(function(){$(".ere-processing").remove()})},e)},popup_alert:function(e,t,a){var n=wp.template("ere-dialog-template");$("body").append(n({ico:e,message:a})),$("#ere-dialog-popup").dialog({title:t,resizable:!1,closeOnEscape:!0,modal:!0,buttons:{Ok:function(){$(this).dialog("close"),$(this).dialog("destroy").remove()}}})},confirm_dialog:function(e,t,a,n){var r=wp.template("ere-dialog-template");$("body").append(r({ico:"fa fa-question-circle",message:t})),$("#ere-dialog-popup").dialog({title:e,resizable:!1,closeOnEscape:!0,modal:!0,buttons:[{text:confirm_yes_text,click:function(){a&&a(),$(this).dialog("destroy").remove()}},{text:confirm_no_text,click:function(){n&&n(),$(this).dialog("close"),$(this).dialog("destroy").remove()}}]})},set_item_effect:function(e,t){if("hide"==t&&(e.css("transition","opacity 1.5s linear, transform 1s"),e.css("-webkit-transition","opacity 1.5s linear, transform 1s"),e.css("-moz-transition","opacity 1.5s linear, transform 1s"),e.css("-ms-transition","opacity 1.5s linear, transform 1s"),e.css("-o-transition","opacity 1.5s linear, transform 1s"),e.css("opacity",0),e.css("transform","scale(0.2)"),e.css("-ms-transform","scale(0.2)"),e.css("-webkit-transform","scale(0.2)")),"show"==t)for(var a=0;a<e.length;a++)!function(t){var n=100*a;setTimeout(function(){$(e[t]).css("opacity",1),$(e[t]).css("transform","scale(1)"),$(e[t]).css("-ms-transform","scale(1)"),$(e[t]).css("-webkit-transform","scale(1)")},n)}(a)},select_term:function(){var e=$("select.property-filter-mb");e.off(),$(e).on("change",function(e){var t=$(this);t.attr("disabled","disabled"),e.preventDefault();var a=$("option:selected",t).attr("value");t.parent().prev().children('[data-filter="'+a+'"]').click()})},contact_agent_by_email:function(){$(".agent-contact-btn","#contact-agent-form").each(function(){$(this).on("click",function(e){e.preventDefault();var t=$(this),a=t.closest("#contact-agent-form"),n=$('[name="target-email"]',a).val(),r=$('[name="property-url"]',a).val(),i=$('[name="name"]',a).val(),o=$('[name="phone"]',a).val(),s=$('[name="email"]',a).val(),l=$('[name="message"]',a).val(),d=!1;0===i.trim().length?($(".name-error",a).removeClass("hidden"),d=!0):$(".name-error",a).hasClass("hidden")||$(".name-error",a).addClass("hidden"),0===o.trim().length?($(".phone-error",a).removeClass("hidden"),d=!0):$(".phone-error",a).hasClass("hidden")||$(".phone-error",a).addClass("hidden");var c=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;0!==s.trim().length&&c.test(s)?$(".email-error",a).hasClass("hidden")||$(".email-error",a).addClass("hidden"):($(".email-error",a).removeClass("hidden"),0===s.trim().length||c.test(s)?$(".email-error",a).text($(".email-error",a).data("error")):$(".email-error",a).text($(".email-error",a).data("not-valid")),d=!0),0===l.trim().length?($(".message-error",a).removeClass("hidden"),d=!0):$(".message-error",a).hasClass("hidden")||$(".message-error",a).addClass("hidden"),t.button({loadingText:'<span class="fa fa-spinner fa-spin"></span>'}),d||(t.button("loading"),$.ajax({type:"post",url:a.attr("action"),data:{action:"ere_contact_agent_ajax",target_email:n,property_url:r,sender_name:i,sender_phone:o,sender_email:s,sender_msg:l},success:function(e){$(".form-messages",a).text(e),t.button("reset")},error:function(){t.button("reset")}}))})})},property_paging:function(){var handle=!0;$(".paging-navigation",".property-paging-wrap").each(function(){$("a",$(this)).button({loadingText:'<span class="fa fa-spinner fa-spin"></span>'}),$("a",$(this)).off("click").on("click",function(event){if(event.preventDefault(),handle){handle=!1;var $this=$(this);$this.css({padding:"0px",height:$this.outerHeight(),width:$this.outerWidth()}),$this.button("loading");var href=$this.attr("href"),data_paged=ERE.get_page_number_from_href(href),data_contain=$this.closest(".property-paging-wrap"),property_content=$this.closest(".ere-property").find(".property-content");$.ajax({url:data_contain.data("admin-url"),data:{action:"ere_property_paging_ajax",layout:data_contain.data("layout"),items_amount:data_contain.data("items-amount"),columns:data_contain.data("columns"),image_size:data_contain.data("image-size"),columns_gap:data_contain.data("columns-gap"),view_all_link:data_contain.data("view-all-link"),paged:data_paged,property_type:data_contain.data("property-type"),property_status:data_contain.data("property-status"),property_feature:data_contain.data("property-feature"),property_city:data_contain.data("property-city"),property_state:data_contain.data("property-state"),property_neighborhood:data_contain.data("property-neighborhood"),property_labels:data_contain.data("property-labels"),property_featured:data_contain.data("property-featured"),author_id:data_contain.data("author-id"),agent_id:data_contain.data("agent-id")},success:function(e){var t=$(".property-item",e),a=$(".property-paging-wrap",e);property_content.css("opacity",0),property_content.html(t),ERE.set_item_effect(t,"hide");var n=property_content.offset().top-30;$("html,body").animate({scrollTop:+n+"px"},500),property_content.css("opacity",1),property_content.imagesLoaded(function(){t=$(".property-item",property_content),ERE.set_item_effect(t,"show"),property_content.closest(".ere-property").find(".property-paging-wrap").html(a.html()),ERE.property_paging(),ERE.property_paging_control(),ERE.favorite(),ERE.tooltip(),ERE_Compare.register_event_compare()}),$this.css({height:"auto",width:"auto",padding:""}),$this.button("reset"),handle=!0},error:function(xhr){var err=eval("("+xhr.responseText+")");console.log(err.Message),$this.css({height:"auto",width:"auto",padding:""}),$this.button("reset"),handle=!0}})}})})},property_paging_control:function(){$(".paging-navigation",".ere-property").each(function(){var e=$(this);0===e.find("a.next").length?e.addClass("next-disable"):e.removeClass("next-disable")})},move_link_to_carousel:function(){$(".property-carousel").each(function(){var e=$(this);$(".owl-carousel",e).on("owlInitialized",function(){if(void 0!=e.data("view-all-link")&&(e.children(".owl-loaded").hasClass("owl-nav-top-right")||e.children(".owl-loaded").hasClass("owl-nav-bottom-center"))){var t=e.find(".view-all-link");t.length>0&&!e.find(".owl-nav").hasClass("disabled")&&(t.removeClass("mg-top-60 sm-mg-top-40"),e.find(".owl-nav").addClass("has-view-all"),e.find(".owl-nav").append(t[0].outerHTML),t.remove())}e.hasClass("owl-move-nav-par-with-heading")&&e.find(".ere-heading").length>0&&!e.find(".ere-heading").hasClass("heading-contain-owl-nav")&&(e.find(".ere-heading").addClass("heading-contain-owl-nav"),e.find(".owl-nav").addClass("owl-nav-top-right").insertAfter(e.find(".ere-heading").children("h2")))})})},execute_nav:function(){$(".ere-property-carousel").each(function(){var e=$(this),t=$(".navigation-wrap",e),a=$(".owl-carousel .property-item",e);ERE.ere_calc_column_padding(t,a),$(".owl-carousel",e).on("owlInitialized",function(){var e=$(this),a=$(".owl-nav",e);t.length>0&&a.length>0&&a.detach().appendTo(t),ERE.ere_calc_column_padding(t,$(".property-item",e))})})},ere_calc_column_padding:function(e,t){if(e.height()<t.height()){var a=Math.floor((t.height()-e.height())/2);e.css({"padding-top":a+"px","padding-bottom":a+"px"})}},execute_slider_nav:function(){$(".ere-property-slider.navigation-middle").each(function(){ERE.ere_calc_nav_top($(".owl-carousel",$(this))),$(".owl-carousel",$(this)).on("owlInitialized",function(){var e=$(this);$(".owl-nav",e).addClass("container"),setTimeout(function(){ERE.ere_calc_nav_top(e)},20)})})},ere_calc_nav_top:function(e){var t=$(".owl-nav",e),a=$(".property-item",e).outerHeight(),n=$(".block-center-inner",e).outerHeight(),r=Math.floor((a-n)/2);t.css("top",r+"px")},sync_property_carousel:function(e){function t(e){var t=e.item.index;i.find(".owl-item").removeClass("current").eq(t).addClass("current");var a=i.find(".owl-item.active").length-1,n=i.find(".owl-item.active").first().index();t>i.find(".owl-item.active").last().index()&&i.data("owl.carousel").to(t,500,!0),t<n&&i.data("owl.carousel").to(t-a,500,!0)}function a(e){var t=e.item.index;r.data("owl.carousel").to(t,500,!0)}var n=$("body").hasClass("rtl"),r=e.find(".property-content-slider"),i=e.find(".property-image-slider");r.owlCarousel({items:1,autoHeight:!0,nav:!1,dots:!1,loop:!1,smartSpeed:500,rtl:n}).on("changed.owl.carousel",t),i.on("initialized.owl.carousel",function(){i.find(".owl-item").eq(0).addClass("current")}).owlCarousel({nav:!1,dots:!1,rtl:n,margin:10,responsive:{992:{items:4},768:{items:3},480:{items:2},0:{items:1}}}).on("changed.owl.carousel",a),i.on("click",".owl-item",function(e){if(e.preventDefault(),!$(this).hasClass("current")){var t=$(this).index();r.data("owl.carousel").to(t,500,!0)}})}},$(document).ready(function(){ERE.init()}),$(window).resize(function(){setTimeout(ERE.execute_nav,20),setTimeout(function(){ERE.execute_slider_nav();var e=$(".pagination-image.ere-property-slider");ERE.sync_property_carousel(e)},10)})}(jQuery);